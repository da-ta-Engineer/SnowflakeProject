-- DATASET SOURCE: https://www.kaggle.com/datasets/lokeshparab/amazon-products-dataset

USE DATABASE DEV;
USE WAREHOUSE DEV_WH;
LS @DEV_AMAZON_STAGE;

CREATE OR REPLACE TABLE DEV.STAGE.T_AMAZON_PRODUCTS(
    NAME STRING,
    MAIN_CATEGORY STRING,
    SUB_CATEGORY STRING,
    IMAGE STRING,
    LINK STRING,
    RATINGS STRING, -- DUE TO LOW DATA QUALITY LOAD NUMBERS AS STRINGS
    NO_OF_RATINGS STRING,
    DISCOUNT_PRICE STRING,
    ACTUAL_PRICE STRING
);

CREATE OR REPLACE FILE FORMAT CSV_AMAZON_FF
    TYPE = CSV
    PARSE_HEADER = TRUE
    FIELD_OPTIONALLY_ENCLOSED_BY = '"'
    FIELD_DELIMITER = ',';

COPY INTO DEV.STAGE.T_AMAZON_PRODUCTS FROM @DEV_AMAZON_STAGE
    FILE_FORMAT = CSV_AMAZON_FF
    PATTERN = '.*.csv'
    MATCH_BY_COLUMN_NAME = 'CASE_INSENSITIVE'
    ON_ERROR = 'CONTINUE';

SELECT COUNT(*) FROM DEV.STAGE.T_AMAZON_PRODUCTS;
SELECT * FROM DEV.STAGE.T_AMAZON_PRODUCTS;
SELECT DISTINCT(MAIN_CATEGORY) FROM DEV.STAGE.T_AMAZON_PRODUCTS;