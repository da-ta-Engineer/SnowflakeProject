LS @DEV_POC_STAGE;

-- azure://saecommdev.blob.core.windows.net/poc/countries-table.json,105697,a025337f648bb8c51a651e21dde8248d,"Tue, 4 Jul 2023 18:19:58 GMT"

USE WAREHOUSE DEV_WH;

COPY INTO DEV.STAGE.T_COUNTRIES_TABLE_JSON FROM @DEV_POC_STAGE FILE_FORMAT = (TYPE = 'JSON') PATTERN = '.*countries-table.json';

SELECT COUNT(*) FROM DEV.STAGE.T_COUNTRIES_TABLE_JSON;

SELECT * FROM DEV.STAGE.T_COUNTRIES_TABLE_JSON;

ALTER WAREHOUSE DEV_WH SUSPEND;

INSERT INTO DEV.CORE.T_COUNTRIES_TABLE_JSON
SELECT F.VALUE:area,
    F.VALUE:cca2 AS CCA2,
    F.VALUE:cca3 AS CCA3,
    F.VALUE:country AS COUNTRY,
    F.VALUE:density AS DENSITY,
    F.VALUE:densityMi AS DENSITY_MI,
    F.VALUE:growthRate AS GROWTH_RATE,
    F.VALUE:landAreaKm AS LAND_AREA_KM,
    F.VALUE:netChange AS NET_CHANGE,
    F.VALUE:place AS PLACE,
    F.VALUE:pop1980 AS POP_1980,
    F.VALUE:pop2000 AS POP_2000,
    F.VALUE:pop2010 AS POP_2010,
    F.VALUE:pop2022 AS POP_2022,
    F.VALUE:pop2023 AS POP_2023,
    F.VALUE:pop2030 AS POP_2030,
    F.VALUE:pop2050 AS POP_2050,
    F.VALUE:rank AS RANK,
    F.VALUE:worldPercentage AS WORLD_PERCENTAGE
FROM DEV.STAGE.T_COUNTRIES_TABLE_JSON T, LATERAL FLATTEN(INPUT => T.JSON) F;

SELECT * FROM DEV.CORE.T_COUNTRIES_TABLE_JSON;

ALTER WAREHOUSE DEV_WH SUSPEND;